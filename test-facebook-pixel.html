<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Facebook Pixel</title>
    <script>
        // Simular dados do formul√°rio
        const formData = {
            email: 'test@example.com',
            phone: '11999999999',
            firstName: 'Test',
            lastName: 'User',
            city: 'S√£o Paulo',
            state: 'SP',
            zip: '01310100',
            country: 'BR',
            fbc: 'fb.1.1234567890.1234567890',
            fbp: 'fb.1.1234567890.1234567890',
            ga_client_id: '123456789.1234567890',
            external_id: 'test_external_id'
        };

        // Fun√ß√£o para testar o envio de dados
        function testFacebookPixel() {
            console.log('üöÄ Iniciando teste do Facebook Pixel...');
            
            // Gerar event_id √∫nico
            const eventId = Date.now().toString(36) + Math.random().toString(36).substr(2);
            
            // Preparar dados no formato otimizado
            const serverSideData = {
                event_name: 'InitiateCheckout',
                event_id: eventId,
                pixel_id: '714277868320104',
                user_data: {
                    em: formData.email.toLowerCase().trim(),
                    ph: formData.phone.replace(/\D/g, ''),
                    fn: formData.firstName.trim(),
                    ln: formData.lastName.trim(),
                    ct: formData.city,
                    st: formData.state,
                    zp: formData.zip,
                    country: formData.country,
                    client_ip_address: '',
                    client_user_agent: navigator.userAgent,
                    fbc: formData.fbc,
                    fbp: formData.fbp,
                    external_id: formData.external_id
                },
                custom_data: {
                    currency: 'BRL',
                    value: 39.90,
                    content_type: 'product',
                    contents: [{
                        id: '6080425',
                        quantity: 1,
                        item_price: 39.90
                    }]
                }
            };
            
            console.log('üìä Dados preparados:', serverSideData);
            
            // Enviar para o server-side
            fetch('https://gtm-GTM-WTL9CQ7W.stape.io/event', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(serverSideData)
            })
            .then(response => {
                console.log('‚úÖ Resposta do server-side:', response.status, response.statusText);
                return response.json();
            })
            .then(result => {
                console.log('‚úÖ Resultado:', result);
            })
            .catch(error => {
                console.error('‚ùå Erro:', error);
                
                // Tentar URL alternativa
                fetch('https://collect.stape.io/v2/s/GTM-WTL9CQ7W/event', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(serverSideData)
                })
                .then(response2 => {
                    console.log('‚úÖ URL alternativa funcionou:', response2.status);
                })
                .catch(error2 => {
                    console.error('‚ùå URL alternativa tamb√©m falhou:', error2);
                });
            });
        }

        // Iniciar teste quando a p√°gina carregar
        window.onload = function() {
            console.log('üéØ P√°gina carregada, clique no bot√£o para testar');
        };
    </script>
</head>
<body>
    <h1>Teste Facebook Pixel</h1>
    <button onclick="testFacebookPixel()">Testar Envio de Dados</button>
    <div id="result"></div>
</body>
</html>